<?xml version="1.0" encoding="UTF-8"?>
<launch>
        <arg name="use_sim_time" default="false" />
        <arg name="rviz" default="true"/>
        <arg name="robot_model" default="tsukutsuku" />
        <arg name="place" default="sb" />
        <arg name="model" default="$(find-pkg-share yp_robot_config)/urdf/$(var robot_model).urdf.xacro" />
        <arg name="autostart" default="false" />
        <arg name="map_path" default="/home/tsukutsuku/data/maps/$(var place)" />
        <arg name="pointcloud_map_file" default="pointcloud_map.pcd" />
        <arg name="pointcloud_map_path" default="$(var map_path)/pcd/$(var pointcloud_map_file)" />
        <arg name="ogm_file" default="map.yaml" />
        <arg name="ogm_path" default="$(var map_path)/ogm/$(var ogm_file)" />
        <arg name="nav2_params_file" default="$(find-pkg-share tsukutsuku_launch)/configs/nav2/nav2_$(var robot_model)_params.yaml" />
        <arg name="ypspur_ros2_bridge_params_file" default="$(find-pkg-share ypspur_ros2_bridge)/config/$(var robot_model)/ypspur_ros2_bridge_params.yaml" />

        <!-- global parameter -->
        <include file="$(find-pkg-share autoware_global_parameter_loader)/launch/global_params.launch.py">
                <arg name="use_sim_time" value="$(var use_sim_time)" />
        </include>

        <!-- map loader -->
        <node pkg="map_loader" exec="pointcloud_map_loader" name="pointcloud_map_loader" output="screen">
                <remap from="output/pointcloud_map" to="/map/pointcloud_map" />
                <param name="pcd_paths_or_directory" value="[$(var pointcloud_map_path)]" />
        </node>
        <include file="$(find-pkg-share map_tf_generator)/launch/map_tf_generator.launch.xml">
                <arg name="input_map_points_topic" value="/map/pointcloud_map" />
        </include>

        <!-- tf publisher -->
        <node name="robot_state_publisher" pkg="robot_state_publisher" exec="robot_state_publisher">
                <param name="robot_description" value="$(command 'xacro $(var model)')" />
        </node>

        <!-- ypspur -->
        <group>
                <push-ros-namespace namespace="ypspur" />
                <include file="$(find-pkg-share ypspur_ros2_bridge)/launch/ypspur_ros2_bridge.launch.py">
                        <arg name="params_file" value="$(var ypspur_ros2_bridge_params_file)" />
                </include>
        </group>
        <!-- sensing -->
        <group>
                <push-ros-namespace namespace="sensing" />
                <include file="$(find-pkg-share yp_launch)/launch/tsukutsuku/sensing.launch.xml" />
        </group>

        <!-- localization -->
        <include file="$(find-pkg-share tsukutsuku_launch)/launch/tsukutsuku_localization.launch.xml" />

        <!-- navigation -->
        <include file="$(find-pkg-share nav2_bringup)/launch/bringup_launch.py">
                <arg name="use_sim_time" value="$(var use_sim_time)" />
                <arg name="autostart" value="$(var autostart)" />
                <arg name="map" value="$(var ogm_path)" />
                <arg name="params_file" value="$(var nav2_params_file)" />
        </include>

        <!-- rviz -->
        <node pkg="rviz2" exec="rviz2" name="rviz2" output="screen" args="-d $(find-pkg-share tsukutsuku_launch)/rviz/tsukutsuku.rviz" if="$(var rviz)" />
</launch>
